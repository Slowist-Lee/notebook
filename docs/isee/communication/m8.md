# Digital Demodulation

# Lecture 8: Digital Demodulation

> [!INFO]
> **主讲人**: Prof. An Liu
> **单位**: College of ISEE, Zhejiang University

## 数字通信系统概览

数字通信系统的目标是将来自信源 (Source) 的信息通过信道 (Channel) 传输给用户 (User)。解调 (Demodulation) 是接收端的关键环节。

![](Pasted%20image%2020260106210638.png)

## 数字解调的基本问题

数字解调的核心任务是从经过信道后被破坏的波形中恢复出原始的比特序列。

![](Pasted%20image%2020260106210652.png)

我们需要回答以下三个核心问题：
1.  **信号损坏的来源是什么？** (What are the sources of signal corruption?)
2.  **如何检测信号以恢复比特序列 $\{\hat{b_i}\}$？** (How to detect the signal?)
3.  **如何评估保真度性能？** (How to evaluate the fidelity performance?)

---

## 信号损坏的来源 (Sources of Signal Corruption)

即使我们假设信道带宽足够，允许大部分已调信号的频率分量通过，信号仍然会受到噪声的干扰。

![[Pasted image 20240520110738.png]]
*图：发送信号 s(t) 经过信道后，叠加了噪声，变成接收信号 y(t)*

> [!IMPORTANT] 主要的噪声来源
> **热噪声 (Thermal Noise):** 由电子设备内部电子的随机热运动引起。

### 热噪声的建模

1.  **宽平稳随机过程 (WSS):** 热噪声 $n(t)$ 通常被建模为一个宽平稳随机过程。
2.  **加性噪声 (Additive):** 热噪声是叠加在信号上的，即接收信号 $y(t) = s(t) + n(t)$。
3.  **高斯分布 (Gaussian):** 在任意时刻 $t_0$，噪声采样值 $n(t_0)$ 是一个服从高斯分布的随机变量，均值为0，方差为 $\sigma_0^2$。
    $$
    n(t_0) \sim \mathcal{N}(0, \sigma_0^2)
    $$
    其概率密度函数 (PDF) 为：
    $$
    f_n(x) = \frac{1}{\sqrt{2\pi\sigma_0}} \exp\left(-\frac{x^2}{2\sigma_0^2}\right)
    $$
    ![](Pasted%20image%2020260106210803.png)

    
    高斯分布的尾部概率通常用 **Q函数** 表示：
    $$
    \text{Pr}\{X > a\} = \int_a^\infty f_n(x)dx = Q\left(\frac{a}{\sigma_0}\right)
    $$

4.  **白噪声 (White Noise):** 热噪声的功率谱密度在非常宽的频率范围内 (从直流到约 $10^{12}$ Hz) 是一个常数。因此，可以近似看作是白过程。
    
    

    
    双边功率谱密度为 $N_0/2$。

> [!NOTE] 总结：AWGN信道
> 由于热噪声是 **加性 (Additive)** 的、其功率谱密度是 **白色 (White)** 的、且服从 **高斯 (Gaussian)** 分布，因此这种信道模型被称为 **加性白高斯噪声 (AWGN)** 信道。

---

## 信号检测 (Detection)

检测过程旨在从含有噪声的接收信号 $y(t) = s(t) + n(t)$ 中恢复出原始比特。

![](Pasted%20image%2020260106210938.png)


检测过程通常包含三个步骤：
1.  **滤波 (Filtering):** 滤除带外噪声，提升信噪比。
2.  **采样 (Sampling):** 在每个码元周期的特定时刻进行采样。
3.  **门限比较 (Threshold Comparison):** 将采样值与一个或多个门限进行比较，以判决发送的是哪个符号。
    -   例如，对于二进制信号：
        -   若 `Sample > 0`，判决为 `1`。
        -   若 `Sample < 0`，判决为 `0`。

## 性能评估：误码率 (Bit Error Rate - BER)

> [!DEFINITION] 误码率 (BER)
> **误码 (Bit Error):** 判决出的比特 $\hat{b_i}$ 与原始发送的比特 $b_i$ 不相等。
> $$
> \{\hat{b_i} \neq b_i\} = \{\hat{b_i}=1 \text{ but } b_i=0\} \cup \{\hat{b_i}=0 \text{ but } b_i=1\}
> $$
> **误码率 (BER) 或误码概率 ($P_b$):** 发生误码的概率。
> $$
> P_b = \text{Pr}\{\hat{b_i}=1, b_i=0\} + \text{Pr}\{\hat{b_i}=0, b_i=1\}
> $$


> [!GOAL] 优化的目标
> 如何设计**滤波器**、**采样器**和**判决门限**来最小化误码率 (BER)？

---

## 二进制检测 (Binary Detection)

### 系统模型

![](Pasted%20image%2020260106211339.png)

-   **发送信号**:
    -   若 $b_i=1$，发送 $s_1(t-i\tau)$
    -   若 $b_i=0$，发送 $s_2(t-i\tau)$
-   **接收信号**: $y(t) = s(t) + n(t)$
-   **接收机操作**:
    1.  $y(t)$ 通过滤波器 $h(t)$，输出为 $z(t)$。
    2.  在 $t_0$ 时刻对 $z(t)$ 采样，得到 $z(t_0)$。
    3.  将 $z(t_0)$ 与门限 $\lambda$ 比较：
        -   若 $z(t_0) > \lambda$，判决 $\hat{b_i}=1$。
        -   若 $z(t_0) < \lambda$，判决 $\hat{b_i}=0$。

**核心问题**: 如何选择门限 $\lambda$、采样点 $t_0$ 和滤波器 $h(t)$ 来最小化BER？

### 接收机结构分析

![](Pasted%20image%2020260106211035.png)

-   **滤波器输出** $z(t)$:
    $z(t) = s_o(t) + n_o(t)$，其中
    -   $s_{o,i}(t) = \int_0^t s_i(x)h(t-x)dx$ 是信号部分的响应。
    -   $n_o(t) = \int_0^t n(x)h(t-x)dx$ 是噪声部分的响应。
-   **重要提示**: 即使输入噪声 $n(t)$ 是白噪声，经过滤波器后的输出噪声 $n_o(t)$ **不再是**白噪声。

-   **采样器输出** $z(t_0)$:
    $z(t_0) = s_o(t_0) + n_o(t_0)$
    由于 $n(t)$ 是高斯过程，线性系统（滤波器）的输出 $n_o(t)$ 也是高斯过程。因此采样值 $n_o(t_0)$ 是一个均值为0，方差为 $\sigma_o^2$ 的高斯随机变量：
    $$
    n_o(t_0) \sim \mathcal{N}(0, \sigma_o^2)
    $$
    因此，在给定发送比特的条件下，采样值 $z(t_0)$ 也服从高斯分布：
    $$
    z(t_0) | b_i=1 \sim \mathcal{N}(s_{o,1}(t_0), \sigma_o^2)
    $$
    $$
    z(t_0) | b_i=0 \sim \mathcal{N}(s_{o,2}(t_0), \sigma_o^2)
    $$

### BER 计算

假设发送 `1` 和 `0` 的概率相等，即 $\text{Pr}\{b_i=1\}=\text{Pr}\{b_i=0\}=1/2$。
$$
\begin{align}
P_b &= \text{Pr}\{\hat{b_i}=1, b_i=0\} + \text{Pr}\{\hat{b_i}=0, b_i=1\} \\
&= \text{Pr}\{z(t_0) > \lambda | b_i=0\}\text{Pr}\{b_i=0\} + \text{Pr}\{z(t_0) < \lambda | b_i=1\}\text{Pr}\{b_i=1\} \\
&= \frac{1}{2} \left[ \text{Pr}\{z(t_0) > \lambda | b_i=0\} + \text{Pr}\{z(t_0) < \lambda | b_i=1\} \right]
\end{align}
$$

![](Pasted%20image%2020260106211607.png)

将高斯分布的尾部概率用Q函数表示：
$$
P_b = \frac{1}{2} \left[ Q\left(\frac{\lambda - s_{o,2}(t_0)}{\sigma_o}\right) + Q\left(\frac{s_{o,1}(t_0) - \lambda}{\sigma_o}\right) \right]
$$

### 1. 最优门限 (Optimal Threshold)

为了最小化 $P_b$，我们需要选择最佳的 $\lambda$ 来最小化两个Q函数之和。从上图可以看出，当门限 $\lambda^*$ 位于两个高斯分布均值的中点时，总错误面积最小。
$$
\lambda^* = \frac{s_{o,1}(t_0) + s_{o,2}(t_0)}{2}
$$

将最优门限 $\lambda^*$ 代入 $P_b$ 表达式，得到最小误码率：
$$
P_b(\lambda^*) = Q\left(\frac{s_{o,1}(t_0) - s_{o,2}(t_0)}{2\sigma_o}\right)
$$
其中：
$$
s_{o,1}(t_0) - s_{o,2}(t_0) = \int_0^{t_0} (s_1(x)-s_2(x))h(t_0-x)dx
$$
$$
\sigma_o^2 = \text{Var}[n_o(t_0)] = \frac{N_0}{2} \int_0^{t_0} h^2(t_0-x)dx
$$

> [!NOTE]
> 此时的误码率 $P_b(\lambda^*)$ 由滤波器 $h(t)$ 和采样时刻 $t_0$ 决定。

### 2. 最优滤波器 (Optimal Filter)

下一步是选择 $h(t)$ 和 $t_0$ 来最大化 $Q(\cdot)$ 函数中的参数，即最大化：
$$
\frac{\left[\int_0^{t_0} (s_1(x)-s_2(x))h(t_0-x)dx\right]^2}{\frac{N_0}{2} \int_0^{t_0} h^2(t_0-x)dx}
$$

根据柯西-施瓦茨不等式，当以下条件满足时，上式取最大值：
1.  **最优采样时刻**: $t_0 = \tau$ (码元结束时刻)
2.  **最优滤波器 (匹配滤波器)**:
    $$
    h(t) = k(s_1(\tau - t) - s_2(\tau - t)), \quad 0 \le t \le \tau
    $$
    其中 $k$ 是任意常数。

> [!DEFINITION] 匹配滤波器 (Matched Filter)
> 最优滤波器的形状与输入信号（这里是 $s_1(t)-s_2(t)$）的时间反褶形式相匹配，因此被称为**匹配滤波器**。

### 最佳二进制检测器 (Optimal Binary Detector)

结合最优门限和最优滤波器，我们得到最佳二进制接收机。

#### 结构
有两种等效的实现方式：

1.  **匹配滤波器 + 采样器**
    - 滤波器 $h(t) = s_1(\tau-t) - s_2(\tau-t)$
    - 在 $t=\tau$ 时刻采样
    
2.  **相关器 (Correlation realization)**
    - 将接收信号 $y(t)$ 与基准信号 $s_1(t)-s_2(t)$ 相乘
    - 将乘积在 $[0, \tau]$ 区间积分
	
![](Pasted%20image%2020260106211638.png)

#### 最优门限
$$
\lambda^* = \frac{1}{2} (s_{o,1}(\tau) + s_{o,2}(\tau)) = \frac{1}{2} \left( \int_0^\tau s_1^2(t)dt - \int_0^\tau s_2^2(t)dt \right) = \frac{1}{2}(E_1 - E_2)
$$
其中 $E_1$ 和 $E_2$ 分别是信号 $s_1(t)$ 和 $s_2(t)$ 的能量。

### 最佳二进制检测器的误码率

将最优滤波器和采样时刻代入 $P_b$ 表达式，得到：
$$
P_b^* = Q\left(\sqrt{\frac{\int_0^\tau (s_1(t)-s_2(t))^2 dt}{2N_0}}\right)
$$

为了更好地分析，我们定义：
-   **每比特能量差 (Energy difference per Bit)** $E_d$:
    $$
    E_d = \int_0^\tau (s_1(t)-s_2(t))^2 dt
    $$
-   **每比特平均能量 (Energy per Bit)** $E_b$:
    $$
    E_b = \frac{1}{2}(E_1 + E_2) = \frac{1}{2}\left(\int_0^\tau s_1^2(t)dt + \int_0^\tau s_2^2(t)dt\right)
    $$
-   **互相关系数 (Cross-correlation coefficient)** $\rho$:
    $$
    \rho = \frac{1}{E_b} \int_0^\tau s_1(t)s_2(t)dt \quad (-1 \le \rho \le 1)
    $$
    $\rho$ 衡量了 $s_1(t)$ 和 $s_2(t)$ 之间的相似性。

可以证明 $E_d = 2(1-\rho)E_b$。因此，最佳误码率为：
$$
P_b^* = Q\left(\sqrt{\frac{E_d}{2N_0}}\right) = Q\left(\sqrt{\frac{E_b(1-\rho)}{N_0}}\right)
$$

> [!SUCCESS] 误码率性能分析
> - BER 性能由两个关键参数决定：
>   1.  **信噪比 $E_b/N_0$**
>   2.  **互相关系数 $\rho$**
> - $E_b/N_0$ 越大，BER 越低。
> - 要使 BER 最小，需要使互相关系数 $\rho$ 最小，即 $\rho=-1$。这种情况称为**反极性信号 (antipodal signals)**。

---

## 各种二进制调制方式的BER性能

### 1. 二进制脉冲幅度调制 (Binary PAM)
- $s_1(t) = A, \quad s_2(t) = -A, \quad 0 \le t \le \tau$
- $E_1 = E_2 = A^2\tau$
- $E_{b,BPAM} = A^2\tau$
- $\rho_{BPAM} = -1$ (反极性信号)
- **Optimal BER**:
  $$
  P_{b,BPAM}^* = Q\left(\sqrt{\frac{2E_b}{N_0}}\right)
  $$
- **Optimal Receiver**: 相关器与 $s_1(t)-s_2(t)=2A$ (即一个常数) 做相关，最优门限 $\lambda^* = \frac{1}{2}(E_1-E_2)=0$。

### 2. 开关键控 (Binary OOK)
- $s_1(t) = A, \quad s_2(t) = 0, \quad 0 \le t \le \tau$
- $E_1 = A^2\tau, \quad E_2 = 0$
- $E_{b,BOOK} = \frac{1}{2}A^2\tau$
- $\rho_{BOOK} = 0$ (正交信号)
- **Optimal BER**:
  $$
  P_{b,BOOK}^* = Q\left(\sqrt{\frac{E_b}{N_0}}\right)
  $$
- **Optimal Receiver**: 最优门限 $\lambda^* = \frac{1}{2}(E_1-E_2) = \frac{1}{2}A^2\tau$。

### 3. 幅度键控 (Binary ASK, Coherent)
- $s_1(t) = A\cos(2\pi f_c t), \quad s_2(t) = 0, \quad 0 \le t \le \tau$
- $E_1 = \frac{1}{2}A^2\tau, \quad E_2 = 0$
- $E_{b,BASK} = \frac{1}{4}A^2\tau$
- $\rho_{BASK} = 0$ (正交信号)
- **Optimal BER**:
  $$
  P_{b,BASK}^* = Q\left(\sqrt{\frac{E_b}{N_0}}\right)
  $$

### 4. 相位键控 (Binary PSK, Coherent)
- $s_1(t) = A\cos(2\pi f_c t), \quad s_2(t) = A\cos(2\pi f_c t + \pi) = -A\cos(2\pi f_c t)$
- $E_1 = E_2 = \frac{1}{2}A^2\tau$
- $E_{b,BPSK} = \frac{1}{2}A^2\tau$
- $\rho_{BPSK} = -1$ (反极性信号)
- **Optimal BER**:
  $$
  P_{b,BPSK}^* = Q\left(\sqrt{\frac{2E_b}{N_0}}\right)
  $$

> [!NOTE] 相干接收机 (Coherent Receiver)
> 对于 ASK 和 PSK，最佳接收机需要在内部产生一个与发射端载波信号 `cos(2πf_c t)` **同频同相** 的参考信号，这种接收机称为**相干接收机**。

### 5. 频率键控 (Binary FSK, Coherent)
- $s_1(t) = A\cos(2\pi(f_c+\Delta f)t), \quad s_2(t) = A\cos(2\pi(f_c-\Delta f)t)$
- $E_1 = E_2 = \frac{1}{2}A^2\tau$
- $E_{b,BFSK} = \frac{1}{2}A^2\tau$
- 当频偏 $\Delta f$ 满足 $\Delta f = \frac{R_b}{4} = \frac{1}{4\tau}$ 时，可以实现 $\rho_{BFSK} \approx 0$ (正交)。
- **Optimal BER (for orthogonal FSK)**:
  $$
  P_{b,BFSK}^* = Q\left(\sqrt{\frac{E_b}{N_0}}\right)
  $$
- **Optimal Receiver**: 使用两个相关器，分别与 $s_1(t)$ 和 $s_2(t)$ 进行相关，然后比较两个输出的大小。

![[Pasted image 20240520121703.png]]
*图：相干BFSK接收机结构*

### 二进制调制总结 I

| 调制方式 | 带宽效率 (90%带内功率) | BER |
| :--- | :--- | :--- |
| Binary PAM | 1 | $Q\left(\sqrt{\frac{2E_{b,BPAM}}{N_0}}\right)$ |
| Binary OOK | 1 | $Q\left(\sqrt{\frac{E_{b,BOOK}}{N_0}}\right)$ |
| Coherent Binary ASK | 0.5 | $Q\left(\sqrt{\frac{E_{b,BASK}}{N_0}}\right)$ |
| Coherent Binary PSK | 0.5 | $Q\left(\sqrt{\frac{2E_{b,BPSK}}{N_0}}\right)$ |
| Coherent Binary FSK | 0.4 | $Q\left(\sqrt{\frac{E_{b,BFSK}}{N_0}}\right)$ |

---

## M进制检测 (M-ary Detection)

### 4-ary PAM 检测

- **发送信号**: 4个电平，例如 $\{-A, -A/3, A/3, A\}$，分别对应符号 `00, 01, 10, 11`。
- **接收机**: 结构与二进制类似，但有3个门限 $\lambda_1, \lambda_2, \lambda_3$ 来划分4个判决区域。

![[Pasted image 20240520122137.png]]
*图：4-ary PAM 检测系统*

- **性能度量**: **误符号率 (Symbol Error Rate - SER, $P_s$)**。
- **SER 与 BER 的关系**:
  对于4-ary PAM，一个符号包含2个比特。假设比特错误是独立的，并且 $P_b$ 很小。
  $P_s = \text{Pr}\{\text{至少一个比特错误}\} = 1 - (1-P_b)^2 = 2P_b - P_b^2 \approx 2P_b$

#### 4-ary PAM 接收机性能
- **最优门限**: 位于相邻信号电平对应的高斯分布均值的中点。

![[Pasted image 20240520122420.png]]
*图：4-ary PAM 信号的概率密度函数与最优门限*

- **SER**:
  $$
  P_s^* = \frac{3}{2} Q\left(\sqrt{\frac{E_d}{2N_0}}\right)
  $$
  其中 $E_d$ 是**相邻**信号波形之间的能量差。
- **与 $E_b$ 的关系**:
  可以计算出 $E_{d,4PAM} = 0.8 E_{s,4PAM} = 1.6 E_{b,4PAM}$ （因为 $E_s=2E_b$）。
  $$
  P_{s,4PAM}^* = \frac{3}{2} Q\left(\sqrt{\frac{0.8E_{s,4PAM}}{N_0}}\right)
  $$
  $$
  P_{b,4PAM}^* \approx \frac{1}{2}P_s^* = \frac{3}{4} Q\left(\sqrt{\frac{0.8E_{b,4PAM}}{N_0}}\right)
  $$

#### 性能对比：Binary PAM vs. 4-ary PAM

| | BER | 带宽效率 |
| :--- | :--- | :--- |
| **Binary PAM** | $Q\left(\sqrt{\frac{2E_{b,BPAM}}{N_0}}\right)$ | 1 |
| **4-ary PAM** | $\frac{3}{4}Q\left(\sqrt{\frac{0.8E_{b,4PAM}}{N_0}}\right)$ | 2 |

> [!WARNING] 结论
> 4-ary PAM 的**带宽效率更高**，但为了达到相同的 $E_b/N_0$，其**误码率性能更差**（对噪声更敏感）。

![[Pasted image 20240520123000.png]]
*图：Binary PAM 和 4-ary PAM 的BER性能曲线对比*

### M-ary PAM

- **星座点**: M个等间距的点，如 $s_i(t) = A - (i-1)d$。
- **性能**:
    - **带宽效率**: $\gamma_{MPAM} = \log_2 M$
    - **SER**:
      $$
      P_s^* = \frac{2(M-1)}{M} Q\left(\sqrt{\frac{E_d}{2N_0}}\right) = \frac{2(M-1)}{M} Q\left(\sqrt{\frac{6E_b\log_2 M}{N_0(M^2-1)}}\right)
      $$
- **趋势**:
    - 随着 M 增大，带宽效率**提高**。
    - 在给定 $E_b$ 的情况下，随着 M 增大，星座点之间距离变小，$E_d$ 减小，SER **恶化**。

### M-ary PSK

#### QPSK (4-PSK)
- **概念**: 可以看作是两个正交的BPSK信号的组合。
  $$
  s_{QPSK}(t) = d_I \frac{A}{\sqrt{2}}\cos(2\pi f_c t) + d_Q \frac{A}{\sqrt{2}}\sin(2\pi f_c t)
  $$
- **解调**: 使用两个并行的相干解调器，分别解调 I 路和 Q 路。
- **BER**:
  $$
  P_{b,QPSK}^* = Q\left(\sqrt{\frac{2E_b}{N_0}}\right)
  $$
- **性能对比: BPSK vs. QPSK**
    - **BER**: 如果 $E_b$ 相同，QPSK 和 BPSK 的误码率性能**完全相同**。
    - **带宽效率**: QPSK 的带宽效率是 BPSK 的**两倍**。

#### M-ary PSK
- **星座点**: M个点均匀分布在圆周上。
- **性能**:
    - **带宽效率**: $\gamma_{MPSK} = \frac{1}{2}\log_2 M$ (相干带通)
    - **SER (for large M)**:
      $$
      P_s^* \approx 2Q\left(\sqrt{\frac{2E_s}{N_0}\sin^2\left(\frac{\pi}{M}\right)}\right)
      $$
- **趋势**:
    - 随着 M 增大，带宽效率**提高**。
    - 随着 M 增大，星座点之间距离变小，SER **恶化**。

---

## 总结与展望

### M进制调制总结 II

| 调制方式 | 带宽效率 (90%带内功率) | BER |
| :--- | :--- | :--- |
| **Binary PAM** | 1 | $Q\left(\sqrt{\frac{2E_{b}}{N_0}}\right)$ |
| **4-ary PAM** | 2 | $\approx \frac{3}{4}Q\left(\sqrt{\frac{0.8E_{b}}{N_0}}\right)$ |
| **M-ary PAM** ($M>4$) | $\log_2 M$ | $\approx \frac{2}{\log_2 M}Q\left(\sqrt{\frac{6\log_2 M}{M^2-1} \frac{E_b}{N_0}}\right)$ |
| **Binary PSK** | 0.5 | $Q\left(\sqrt{\frac{2E_{b}}{N_0}}\right)$ |
| **QPSK** | 1 | $Q\left(\sqrt{\frac{2E_{b}}{N_0}}\right)$ |
| **M-ary PSK** ($M>4$) | $\frac{1}{2}\log_2 M$ | $\approx \frac{2}{\log_2 M}Q\left(\sqrt{2\sin^2(\frac{\pi}{M})\log_2 M \frac{E_b}{N_0}}\right)$ |

### 性能比较

![[Pasted image 20240520124237.png]]
*图：不同调制方式的带宽效率 vs. 所需 $E_b/N_0$ ($P_b^*=10^{-5}$)*

- **BPSK/QPSK**: 在抗噪声性能和带宽效率之间提供了较好的平衡。
- **高阶 PSK (如8PSK, 16PSK)**: 带宽效率更高，但需要更高的信噪比。
- **香农极限**: 图中虚线表示了在给定带宽效率下，理论上可达到的最低 $E_b/N_0$。

### 延伸问题
- **给定 $E_b/N_0$，能达到的最高带宽效率是多少？**
  - 👉 **信息论** -- AWGN信道容量
- **如何实现最高的带宽效率？**
  - 👉 **信道编码理论**
- **如果信道不是LTI系统（如无线信道）怎么办？**
  - 👉 **无线通信理论**
  