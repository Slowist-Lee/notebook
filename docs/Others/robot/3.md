# 正向运动学 I (FORWARD KINEMATICS I)

 正向运动学 (Forward Kinematics) 的核心任务是：**已知机器人所有关节的角度（或位移），计算其末端执行器在空间中的位置和姿态。** 本章将介绍实现这一目标的核心工具——齐次变换矩阵和D-H参数法。


![|374](Pasted%20image%2020251008144117.png)
## 3.1 位置与姿态 (Position & Orientation)

#### 位置与姿态的统一描述

> [!note] 
> 机械臂末端执行器上参考点 P 的位置可以用一个位置向量 $\overrightarrow{OP}$ 来表示。这个向量综合了**旋转**和**平移**两个部分。
>
> *   点 P 在本体坐标系 1 中的坐标为 $^1\mathbf{r}$。
> *   坐标系 1 相对于坐标系 0 进行了旋转，由旋转矩阵 $^0R_1$ 描述。
> *   坐标系 1 的原点相对于坐标系 0 的原点发生了平移，由平移向量 $^0\mathbf{d}$ 描述。
>
> 因此，点 P 在世界坐标系 0 中的位置 $^0\mathbf{r}$ 为：
> $$
> \overrightarrow{OP} = {}^0\mathbf{r} = {}^0R_1 \ {}^1\mathbf{r} + {}^0\mathbf{d}
> $$
> 展开为分量形式：
> $$
> \begin{bmatrix} X \\ Y \\ Z \end{bmatrix} =
> \begin{bmatrix} r_{11} & r_{12} & r_{13} \\ r_{21} & r_{22} & r_{23} \\ r_{31} & r_{32} & r_{33} \end{bmatrix}
> \begin{bmatrix} x \\ y \\ z \end{bmatrix} +
> \begin{bmatrix} d_x \\ d_y \\ d_z \end{bmatrix}
> $$
>
>  ![|384](Pasted%20image%2020251008144152.png)
>  

#### 齐次变换

> [!abstract] 齐次变换 (Homogeneous Transformation)
> 我们已经知道，一个点 P 的位置可以表示为旋转和平移的组合：
> $$
> \overrightarrow{OP} = {}^0\mathbf{r} = {}^0\mathbf{d} + {}^0R_1 \ {}^1\mathbf{r}
> $$
> 为了将这两种运算统一为单次的矩阵乘法，我们引入**齐次变换 (Homogeneous Transformation)**。
> $$
> \begin{bmatrix} ^0\mathbf{r} \\ 1 \end{bmatrix} =
> \begin{bmatrix} ^0R_1 & ^0\mathbf{d} \\ \mathbf{0}_{1\times3} & 1 \end{bmatrix}
> \begin{bmatrix} ^1\mathbf{r} \\ 1 \end{bmatrix} =
> {}^0T_1
> \begin{bmatrix} ^1\mathbf{r} \\ 1 \end{bmatrix}
> $$
>
> ### 齐次变换矩阵 (Homogeneous Transformation Matrix)
>
> 这个 4x4 的矩阵 $^0T_1$ 结构如下：
> $$
> ^0T_1 = \left[ \begin{array}{ccc:c} r_{11} & r_{12} & r_{13} & d_x \\ r_{21} & r_{22} & r_{23} & d_y \\ r_{31} & r_{32} & r_{33} & d_z \\ \hdashline 0 & 0 & 0 & 1 \end{array} \right]
> $$
>
> ### 关于齐次坐标的说明
> > [!note] 齐次坐标 (Homogeneous coordinates)
> > *   用一个 (n+1) 维向量来表示一个 n 维向量的方法，称为**齐次表示法 (homogeneous representation)**。
> > *   附加的元素 c 是一个**缩放因子 (scale factor)**。
> > $$
> > \mathbf{r} = \begin{bmatrix} x \\ y \\ z \end{bmatrix} \implies
> > \begin{bmatrix} c\mathbf{r} \\ c \end{bmatrix} =
> > \begin{bmatrix} cx \\ cy \\ cz \\ c \end{bmatrix} = 
> > \begin{bmatrix} r_1 \\ r_2 \\ r_3 \\ c \end{bmatrix}
> > $$
> > *   只要 $c \ne 0$，无论 $c$ 如何变化，齐次坐标都表示同一个向量。
>
> ---
>
> ### 齐次变换矩阵的分解
>
> 齐次变换矩阵关联了坐标系 1 和 0 中的坐标。它通过两种基本变换来同时表示**位姿 (pose)** 和**位置 (position)** 信息：
>
> *   **旋转变换 (Rotation transformation)**:
>     $$
>     ^0T_1 =
>     \begin{bmatrix} ^0R_1 & \mathbf{0}_{3\times1} \\ \mathbf{0}_{1\times3} & 1 \end{bmatrix}
>     $$
>
> *   **平移变换 (Translation transformation)**:
>     $$
>     ^0T_1 =
>     \begin{bmatrix} \mathbf{I}_{3\times3} & ^1\mathbf{d} \\ \mathbf{0}_{1\times3} & 1 \end{bmatrix}
>     $$
>


> [!important] 连续变换 (Successive Transformation)
> 
> ![|378](Pasted%20image%2020251008144300.png)
> 
> 对于一个多连杆机器人，从基座到末端的总变换，可以通过**依次连乘**每个连杆之间的齐次变换矩阵得到。
>
> 假设有一个点，在坐标系 2 中的坐标是 $^2\mathbf{r}$，我们想求它在坐标系 0 中的坐标 $^0\mathbf{r}$。
>
> 1.  从 frame 2 到 frame 1: $^1\mathbf{r} = {}^1R_2 \ ^2\mathbf{r} + {}^1\mathbf{d}_2$
> 2.  从 frame 1 到 frame 0: $^0\mathbf{r} = {}^0R_1 \ ^1\mathbf{r} + {}^0\mathbf{d}_1$
>
> 将 1 式代入 2 式，得到：
> $$
> ^0\mathbf{r} = {}^0R_1 ({}^1R_2 \ ^2\mathbf{r} + {}^1\mathbf{d}_2) + {}^0\mathbf{d}_1 = ({}^0R_1 {}^1R_2) \ ^2\mathbf{r} + ({}^0R_1 {}^1\mathbf{d}_2 + {}^0\mathbf{d}_1)
> $$
>
> 使用齐次变换矩阵，这个复杂的过程就变成了简单的矩阵乘法：
> $$
> \begin{bmatrix} ^0\mathbf{r} \\ 1 \end{bmatrix} =
> \underbrace{
> \begin{bmatrix} ^0R_1 & ^0\mathbf{d}_1 \\ \mathbf{0} & 1 \end{bmatrix}
> }_{^0T_1}
> \underbrace{
> \begin{bmatrix} ^1R_2 & ^1\mathbf{d}_2 \\ \mathbf{0} & 1 \end{bmatrix}
> }_{^1T_2}
> \begin{bmatrix} ^2\mathbf{r} \\ 1 \end{bmatrix}
> $$
>
> 因此，总的变换矩阵为：
> $$
> ^0T_2 = {}^0T_1 \ {}^1T_2
> $$
> 对于一个 n 连杆的机器人，从末端 (frame n) 到基座 (frame 0) 的总变换为：
> $$
> ^0\mathbf{r} = {}^0T_n \ ^n\mathbf{r} \quad \text{其中} \quad ^0T_n = {}^0T_1 \ {}^1T_2 \cdots {}^{n-1}T_n
> $$
>


> [!example] 示例 EX 3-1-1
> > [!question] 问题
> > 找到刚体 B 在坐标系 G 中的位置和姿态。B 的运动顺序如下：
> > 1. 绕 **X 轴** 旋转 $\alpha$ 角。
> > 2. 沿 **X 轴** 平移距离 $a$。
> > 3. 沿 **Z 轴** 平移距离 $d$。
> > 4. 绕 **Z 轴** 旋转 $\theta$ 角。
>
>  解 ：
> 最后一个操作（绕Z轴转$\theta$）的矩阵 $T_{Z,\theta}$ 在最左边，所有操作都是相对于固定参考系的。
> $$
> T = T_{Z,\theta} \ T_{Z,d} \ T_{X,a} \ T_{X,\alpha}
> $$
> $$
> T =
> \underbrace{ \begin{bmatrix} c\theta & -s\theta & 0 & 0 \\ s\theta & c\theta & 0 & 0 \\ 0 & 0 & 1 & 0 \\ 0 & 0 & 0 & 1 \end{bmatrix} }_{T_{Z,\theta}}
> \underbrace{ \begin{bmatrix} 1 & 0 & 0 & 0 \\ 0 & 1 & 0 & 0 \\ 0 & 0 & 1 & d \\ 0 & 0 & 0 & 1 \end{bmatrix} }_{T_{Z,d}}
> \underbrace{ \begin{bmatrix} 1 & 0 & 0 & a \\ 0 & 1 & 0 & 0 \\ 0 & 0 & 1 & 0 \\ 0 & 0 & 0 & 1 \end{bmatrix} }_{T_{X,a}}
> \underbrace{ \begin{bmatrix} 1 & 0 & 0 & 0 \\ 0 & c\alpha & s\alpha & 0 \\ 0 & s\alpha & c\alpha & 0 \\ 0 & 0 & 0 & 1 \end{bmatrix} }_{T_{X,\alpha}}
> $$
>


> [!example] 示例 EX 3-1-2
> 
> ![](Pasted%20image%2020251008145410.png)
> 
> > [!question] 问题
> > 根据图中展示的坐标系，利用变换矩阵的性质，求出 $^0T_i, \ ^{i-1}T_i, \ ^jT_i$。
>
> **解**:
> 通过观察图中各坐标系的位置和姿态关系，可以写出它们之间的变换矩阵。
>
> *   从 Frame 0 到 Frame 1 ($^0T_1$):
>     $$
>     ^0T_1 = \begin{bmatrix} -1 & 0 & 0 & 0 \\ 0 & 0 & -1 & e+c \\ 0 & -1 & 0 & a-d \\ 0 & 0 & 0 & 1 \end{bmatrix}
>     $$
> *   从 Frame 2 到 Frame 1 ($^1T_2$):
>     $$
>     ^1T_2 = \begin{bmatrix} 0 & -1 & 0 & b \\ 0 & 0 & -1 & a-d \\ 1 & 0 & 0 & 0 \\ 0 & 0 & 0 & 1 \end{bmatrix}
>     $$
> *   从 Frame 0 到 Frame 2 ($^0T_2 = {}^0T_1 \ {}^1T_2$，求解无需用矩阵乘法):
>     $$
>     ^0T_2 = \begin{bmatrix} 0 & 1 & 0 & -b \\ -1 & 0 & 0 & e+c \\ 0 & 0 & 1 & 0 \\ 0 & 0 & 0 & 1 \end{bmatrix}
>     $$
>

### 逆齐次变换

> [!note] 逆齐次变换 (Inverse Homogeneous Transformation)
> 使用齐次变换矩阵的优点是简化运算，但代价是**失去了正交性**。因此，它的逆矩阵**不等于**它的转置矩阵 ($T^{-1} \ne T^T$)。
>
> ![|372](Pasted%20image%2020251008145726.png)
>
> 齐次变换矩阵 $^0T_1$ 的逆 $^0T_1^{-1} = {}^1T_0$ 可以通过以下公式计算：
> $$
> ^0T_1 = \begin{bmatrix} ^0R_1 & ^0\mathbf{d} \\ \mathbf{0} & 1 \end{bmatrix}
> \implies
> ({}^0T_1)^{-1} = {}^1T_0 =
> \begin{bmatrix} ({}^0R_1)^{-1} & -({}^0R_1)^{-1} {}^0\mathbf{d} \\ \mathbf{0} & 1 \end{bmatrix}
> $$
> 因为旋转矩阵 $R$ 是正交的，所以 $R^{-1} = R^T$。代入上式得到：
> $$
> {}^1T_0 =
> \begin{bmatrix} ({}^0R_1)^T & -({}^0R_1)^T {}^0\mathbf{d} \\ \mathbf{0} & 1 \end{bmatrix}
> $$
>


> [!example] 示例 EX 3-1-3: SCARA 机器人正向运动学
> 
> ![|475](Pasted%20image%2020251008145747.png)
> 
> > [!question] 问题
> > 图中展示了一个 R||R||P (SCARA) 机器人。基座上有世界坐标系 G，连杆1上有坐标系 $B_1$，连杆3的末端有坐标系 $B_2$。求末端执行器的位姿。
> >
>
> **解**:
> 我们的目标是求总变换矩阵 $^G T_{B2}$。我们可以通过链式法则计算：$^G T_{B2} = {}^G T_{B1} \cdot {}^{B1} T_{B2}$。
>
> 1.  **计算 $B_1 \to G$ 的变换矩阵 $^G T_{B1}$**:
>     *   旋转：绕 G 的 Z 轴旋转 $\theta_1$。
>     *   平移：沿 G 旋转后的新 X 轴平移 $l_1$。
>     $$
>     ^G T_{B1} = \begin{bmatrix} \cos\theta_1 & -\sin\theta_1 & 0 & l_1 \cos\theta_1 \\ \sin\theta_1 & \cos\theta_1 & 0 & l_1 \sin\theta_1 \\ 0 & 0 & 1 & 0 \\ 0 & 0 & 0 & 1 \end{bmatrix}
>     $$
> 2.  **计算 $B_2 \to B_1$ 的变换矩阵 $^{B1} T_{B2}$**:
>     *   旋转：绕 $B_1$ 的 Z 轴旋转 $\theta_2$。
>     *   平移：沿 $B_1$ 旋转后的新 X 轴平移 $l_2$，沿 Z 轴平移 $-h$。
>     $$
>     ^{B1} T_{B2} = \begin{bmatrix} \cos\theta_2 & -\sin\theta_2 & 0 & l_2 \cos\theta_2 \\ \sin\theta_2 & \cos\theta_2 & 0 & l_2 \sin\theta_2 \\ 0 & 0 & 1 & -h \\ 0 & 0 & 0 & 1 \end{bmatrix}
>     $$
> 3.  **计算总变换矩阵 $^G T_{B2}$**:
>     $$
>     ^G T_{B2} = {}^G T_{B1} \cdot {}^{B1} T_{B2} =
>     \begin{bmatrix}
>     c(\theta_1+\theta_2) & -s(\theta_1+\theta_2) & 0 & l_1c\theta_1 + l_2c(\theta_1+\theta_2) \\
>     s(\theta_1+\theta_2) & c(\theta_1+\theta_2) & 0 & l_1s\theta_1 + l_2s(\theta_1+\theta_2) \\
>     0 & 0 & 1 & -h \\
>     0 & 0 & 0 & 1
>     \end{bmatrix}
>     $$
>     *   **姿态 (Pose)**: 从旋转部分可以看出，末端的 RPY 角为 $(0, 0, \theta_1+\theta_2)$。
>     *   **位置 (Position)**: 末端的位置向量为 $[l_1c\theta_1 + l_2c(\theta_1+\theta_2), \ l_1s\theta_1 + l_2s(\theta_1+\theta_2), \ -h]^T$。
>


> [!example] 示例 EX 3-1-4: 绕任意轴旋转
> 
> ![|390](Pasted%20image%2020251008145855.png)
> 
> > [!question] 问题
> > 求一个绕**不经过原点的任意轴 $\mathbf{u}$** 旋转的齐次变换矩阵。
>
> **解**:
> 这个问题可以通过一个三步法解决：  
> 1.  **平移**：将旋转轴 $\mathbf{u}$ 平移，使其通过坐标系原点。这需要一个平移变换 $T(-\mathbf{d})$，其中 $\mathbf{d}$ 是原点到旋转轴上某点的向量。
> 2.  **旋转**：绕经过原点的轴 $\mathbf{u}$ 进行旋转。变换为 $T_u(\phi)$。
> 3.  **平移回去**：将旋转后的物体平移回原来的位置。变换为 $T(\mathbf{d})$。
>
> 总变换是这三个变换的复合。因为这些操作是相对于固定参考系进行的，所以使用前乘，最后的变换在最左边：
> $$
> T = T(\mathbf{d}) \ T_u(\phi) \ T(-\mathbf{d})
> $$
> $$
> T =
> \begin{bmatrix} \mathbf{I} & \mathbf{d} \\ \mathbf{0} & 1 \end{bmatrix}
> \begin{bmatrix} R_u(\phi) & \mathbf{0} \\ \mathbf{0} & 1 \end{bmatrix}
> \begin{bmatrix} \mathbf{I} & -\mathbf{d} \\ \mathbf{0} & 1 \end{bmatrix}
> =
> \begin{bmatrix} R_u(\phi) & (\mathbf{I} - R_u(\phi))\mathbf{d} \\ \mathbf{0} & 1 \end{bmatrix}
> $$
>



## 3.2 Denavit-Hartenberg 方法

> [!note] 3.2 Denavit-Hartenberg (D-H) 方法
> *   串联关节机器人（机械臂）结构多样，这给控制带来了复杂性。
> *   因此，有必要发展一种**通用的方法**来定义机械臂的几何结构，以便用统一的方式控制不同的机械臂。
> *   最有用的方法之一就是所谓的 **Denavit-Hartenberg (D-H) 标记法**，它能以通用的方式描述机械臂的结构。
>

> [!note] 连杆的标记法 (Notations of Links)
> *   一个有 $n$ 个关节的机器人，将有 $n$ 个可动连杆和 1 个固定的基座连杆。
> *   连杆编号从 **0**（固定的基座）开始，到 **1**（第一个可动连杆），依次递增，直到 **n**（末端执行器连杆）。
> *   **连杆 i** 通过 **关节 i** 连接到其前一个连杆 **i-1** (近端)，并通过 **关节 i+1** 连接到其后一个连杆 **i+1** (远端)。
>
>  ![|500](Pasted%20image%2020251008151044.png)

> [!abstract] D-H 参数 (Denavit-Hartenberg Parameters)
> 解决正向运动学问题，就是找到**连杆 i** 和 **连杆 i-1** 之间的变换矩阵 $T$ 的过程。
> 连杆 i 相对于连杆 i-1 的位姿由两个方面决定：**旋转** 和 **机械部件的几何形状**。
> 这两个方面被四个 **D-H 参数** 所量化：
>
> *   **旋转相关**:
>     - 相对旋转角 $\theta$ (关节角)
> *   **几何形状相关**:  
>     - 连杆距离 $d$ (关节偏移)  
>     - 连杆扭转 $\alpha$ (连杆扭转角)  
>     - 连杆长度 $a$ (连杆长度)  
>

![|348](Pasted%20image%2020251008151207.png)

> [!important] D-H 方法步骤 1: 建立坐标系
> 使用这 4 个几何参数来确定变换矩阵 $T$ 的过程，被称为 Denavit-Hartenberg (DH) 方法。
>
> ### Step 1: 建立坐标系
>
> 1.  **确定 $z_i$ 轴**:
>     *   对于**旋转关节**，**$z_i$ 轴**与连杆 $i$ 的**远端关节轴（即关节 $i+1$）** 对齐。
>     *   对于**移动关节**，**$z_i$ 轴**与平移的方向对齐。
>     *   $z_i$ 轴的方向可以任选其一。
>
>
> 2.  **确定原点 $o_i$ 和 $x_i$ 轴**:
>     *   **$x_i$ 轴** 沿着 **$z_{i-1}$ 轴**和 **$z_i$ 轴**之间的**公垂线**，方向从 $z_{i-1}$ 指向 $z_i$。
>       $$ x_i = \pm (z_{i-1} \times z_i) $$
>     *   **原点 $o_i$** 是 **$z_i$ 轴**与上述**公垂线**的交点。
>     *   **特殊情况**：如果 $z_{i-1}$ 和 $z_i$ 平行，则公垂线有无数条。此时，选择一条通过 $o_{i-1}$ 并且与之前的 $x$ 轴共线的公垂线。如果 $z_{i-1}$ 和 $z_i$ 相交，则公垂线长度为0，此时 $x_i$ 垂直于 $z_{i-1}$ 和 $z_i$ 所在的平面。
>
> 3.  **确定 $y_i$ 轴**:
>     *   **$y_i$ 轴** 由右手定则确定：
>       $$ y_i = z_i \times x_i $$
>

> [!important] D-H 方法步骤 2: 确定 D-H 参数
> 在建立好所有连杆的坐标系后，我们就可以通过测量两个相邻坐标系（frame $i-1$ 和 frame $i$）之间的几何关系来确定四组 D-H 参数。
>
> ### Step 2: 识别 D-H 参数
>
> *   **关节参数 (Joint Parameters)** - 通常是变量  
>     1.  **关节角 $\theta_i$ (Joint angle)**: 绕着 **$z_{i-1}$** 轴，从 **$x_{i-1}$** 旋转到与 **$x_i$** 平行所需的角度。  
>     2.  **关节距离 $d_i$ (Joint distance)**: 沿着 **$z_{i-1}$** 轴，从 **$x_{i-1}$** 移动到 **$x_i$** 的距离。  
> *   **连杆参数 (Link Parameters)** - 通常是常量  
>     3.   **连杆长度 $a_i$ (Link length)**: 沿着 **$x_i$** 轴，从 **$z_{i-1}$** 移动到 **$z_i$** 的距离。  
>     4.   **连杆扭转 $\alpha_i$ (Link twist)**: 绕着 **$x_i$** 轴，从 **$z_{i-1}$** 旋转到与 **$z_i$** 平行所需的角度。   
> 



> [!example] 示例 Ex 3-2-1: 3R 机械臂
>
> ![|450](Pasted%20image%2020251008153404.png)
> 
> > [!question] 问题
> > 为下图所示的 3R 机械臂填写 D-H 参数表。
> >
>
> **解**:
> 1.  **建立坐标系** (如图所示)。
> ![](Pasted%20image%2020251008153429.png)
> 2.  **提取D-H参数**，填入表格。
>
> | Frame No. (i) | 连杆扭转 ($\alpha_i$) | 连杆长度 ($a_i$) | 关节距离 ($d_i$) | 关节角 ($\theta_i$) |
> | :-----------: | :------------------: | :---------------: | :-----------------: | :-----------------: |
> |       1       |          $0$         |        $a$        |         $0$         |     $\theta_1$      |
> |       2       |       $-90^\circ$    |        $b$        |         $0$         |     $\theta_2$      |
> |       3       |          $0$         |        $0$        |         $0$         |     $\theta_3$      |
>



> [!summary] 关于 D-H 参数的注意事项
> 3.  **初始位形 (Home Configuration)**：当所有关节变量（如 $\theta_i$）都为零时，机器人的构型称为初始位形或静止位，这是机器人所有运动的参考基准。
> 4.  **非唯一性**：D-H 坐标系不是唯一的。因为 $z$ 轴的方向是任意的，并且当 $z_{i-1}$ 和 $z_i$ 相交时，$x$ 轴的选择也是任意的。
> 5.  **$x_i$ 的选择**：当大部分关节参数为零时，$x_i$ 的方向可以选择一个更方便的参考系。
> 6.  **最佳静止位**：最好的静止位姿是让尽可能多的坐标轴相互平行且共面。
>


> [!example] 示例 Ex 3-2-2: PUMA 200 机器人
> > [!question] 问题
> > 为 PUMA 200 机器人填写 D-H 参数表。
> >
> >  ![|500](Pasted%20image%2020251008153508.png)
>
> **解**:
> 同样地，先建立坐标系，然后提取参数。
>
> ![|353](Pasted%20image%2020251008154146.png)
> 
> | No. (i) | $a_i$ | $\alpha_i$ | $d_i$ | $\theta_i$ | 关节变量的初始值 |
> | :---: | :-: | :------: | :-: | :------: |:---:|
> |   1   |  0  |  $-90^\circ$ |  13 | $\theta_1$ | |
> |   2   |  8  |   $0$    |   0 | $\theta_2$ | |
> |   3   |  0  |  $90^\circ$  |  -e | $\theta_3$ | ($90^\circ$) |
> |   4   |  0  |  $90^\circ$  |   8 | $\theta_4$ | ($180^\circ$) |
> |   5   |  0  |  $90^\circ$  |   0 | $\theta_5$ | ($90^\circ$) |
> |   6   |  0  |   $0$    |   t | $\theta_6$ | |
>
> 再次强调：**D-H 坐标系的建立不是唯一的。**
>



